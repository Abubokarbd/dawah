<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡¶¶‡¶æ‡¶ì‡ßü‡¶æ‡¶π - ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶´‡ßã‡¶∞‡¶æ‡¶Æ</title>

  <!-- SEO & Social Meta -->
  <meta name="description" content="‡¶¶‡¶æ‡¶ì‡ßü‡¶æ‡¶π ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™: ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡ßÄ ‡¶¨‡¶ø‡¶∑‡ßü‡ßá ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶´‡ßã‡¶∞‡¶æ‡¶Æ">
  <meta name="keywords" content="‡¶¶‡¶æ‡¶ì‡ßü‡¶æ‡¶π, ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ, ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü, ‡¶´‡ßã‡¶∞‡¶æ‡¶Æ, ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ">
  <meta name="author" content="Abubokar">
  <meta property="og:title" content="‡¶¶‡¶æ‡¶ì‡ßü‡¶æ‡¶π ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶´‡ßã‡¶∞‡¶æ‡¶Æ">
  <meta property="og:description" content="‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡ßÄ ‡¶¨‡¶ø‡¶∑‡ßü‡ßá ‡¶Ü‡¶≤‡ßã‡¶ö‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¶‡¶æ‡¶ì‡ßü‡¶æ‡¶π ‡¶´‡ßã‡¶∞‡¶æ‡¶Æ‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶®">
  <meta property="og:image" content="https://abubokarbd.github.io/dawah/logo.png">
  <meta property="og:url" content="https://abubokarbd.github.io/dawah/comment-forum.html">

  <!-- App Icon & Favicon -->
  <link rel="icon" href="https://abubokarbd.github.io/dawah/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="https://abubokarbd.github.io/dawah/app-icon.png">

  <!-- Hind Siliguri ‡¶´‡¶®‡ßç‡¶ü -->
  <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Hind Siliguri', sans-serif;
      background-color: #033E3E;
      color: #FFFFFF;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    #loader {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #033E3E;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .container {
      max-width: 960px;
      margin: auto;
      padding: 20px;
    }

    .app-title {
      font-size: 48px;
      margin-top: 10px;
      color: #00FFFF;
      font-weight: bold;
    }

    .app-subtitle {
      font-size: 20px;
      color: #AADDEE;
      margin-top: -10px;
      margin-bottom: 20px;
    }

    .comment-form {
      margin: 20px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    .comment-form input, .comment-form textarea {
      width: 100%;
      max-width: 500px;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: #022B2B;
      color: #FFFFFF;
      font-family: 'Hind Siliguri', sans-serif;
      font-size: 16px;
    }

    .comment-form textarea {
      min-height: 100px;
      resize: vertical;
    }

    .comment-form button {
      background: linear-gradient(145deg, #046868, #022B2B);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }

    .comment-form button:hover {
      background: linear-gradient(145deg, #0AAFAF, #055050);
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(0,0,0,0.4);
    }

    .comment-form button:active {
      transform: scale(0.97);
    }

    .auth-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 15px;
    }

    .comment-list {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .comment {
      background: linear-gradient(145deg, #046868, #022B2B);
      padding: 15px;
      border-radius: 10px;
      text-align: left;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    .admin-comment {
      border: 2px solid #FFD700;
      background: linear-gradient(145deg, #055050, #013636);
    }

    .comment-header {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #AADDEE;
      margin-bottom: 10px;
    }

    .admin-badge {
      background: #FFD700;
      color: #033E3E;
      padding: 2px 8px;
      border-radius: 5px;
      font-size: 12px;
      margin-left: 5px;
    }

    .comment-body {
      font-size: 16px;
      color: #FFFFFF;
    }

    .comment-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .comment-actions button {
      background: linear-gradient(145deg, #046868, #022B2B);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .comment-actions button:hover {
      background: linear-gradient(145deg, #0AAFAF, #055050);
      transform: translateY(-2px);
    }

    .comment-actions button:active {
      transform: scale(0.97);
    }

    .delete-button {
      background: linear-gradient(145deg, #A10000, #700000);
      color: white;
    }

    .delete-button:hover {
      background: linear-gradient(145deg, #C10000, #900000);
      transform: translateY(-2px);
    }

    .reply-form {
      margin-top: 10px;
      display: none;
      flex-direction: column;
      gap: 10px;
    }

    .reply-form textarea {
      min-height: 60px;
    }

    .replies {
      margin-top: 10px;
      padding-left: 20px;
      border-left: 2px solid #00FFFF;
    }

    .reply {
      background: linear-gradient(145deg, #055050, #022B2B);
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
    }

    .admin-reply {
      border: 2px solid #FFD700;
      background: linear-gradient(145deg, #044444, #013636);
    }

    .reply-header {
      font-size: 13px;
      color: #AADDEE;
      margin-bottom: 5px;
    }

    .reply-body {
      font-size: 14px;
      color: #FFFFFF;
    }

    .load-more {
      background: linear-gradient(145deg, #046868, #022B2B);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      margin: 20px auto;
      display: block;
      box-shadow: 0 3px 8px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }

    .load-more:hover {
      background: linear-gradient(145deg, #0AAFAF, #055050);
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(0,0,0,0.4);
    }

    .load-more:active {
      transform: scale(0.97);
    }

    /* ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡¶™‡¶Ü‡¶™ */
    .login-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(145deg, #046868, #022B2B);
      color: #FFFFFF;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
      z-index: 1001;
      max-width: 90%;
      width: 350px;
      text-align: center;
      font-family: 'Hind Siliguri', sans-serif;
    }

    .login-popup h3 {
      color: #00FFFF;
      margin-bottom: 20px;
      font-size: 20px;
    }

    .login-popup input {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: #022B2B;
      color: #FFFFFF;
      font-size: 16px;
      margin-bottom: 15px;
      box-sizing: border-box;
    }

    .login-popup button {
      background: linear-gradient(145deg, #046868, #022B2B);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px;
      transition: all 0.3s ease;
    }

    .login-popup button:hover {
      background: linear-gradient(145deg, #0AAFAF, #055050);
      transform: translateY(-2px);
    }

    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
    }

    .popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(145deg, #046868, #022B2B);
      color: #FFFFFF;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.4);
      z-index: 1000;
      max-width: 90%;
      width: 300px;
      text-align: center;
      font-family: 'Hind Siliguri', sans-serif;
      font-size: 16px;
    }

    .popup-content {
      margin-bottom: 15px;
    }

    .popup-close {
      background: #00FFFF;
      color: #033E3E;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.3s ease;
    }

    .popup-close:hover {
      background: #0AAFAF;
    }

    @media (max-width: 600px) {
      .app-title {
        font-size: 36px;
      }

      .app-subtitle {
        font-size: 18px;
      }

      .comment-form input, .comment-form textarea {
        font-size: 14px;
      }

      .comment-form button {
        font-size: 14px;
        padding: 8px 16px;
      }

      .comment {
        padding: 10px;
      }

      .comment-body {
        font-size: 14px;
      }

      .comment-actions button {
        font-size: 12px;
        padding: 6px 10px;
      }

      .load-more {
        font-size: 14px;
        padding: 8px 16px;
      }

      .login-popup {
        width: 90%;
        padding: 20px;
      }

      .login-popup h3 {
        font-size: 18px;
      }

      .popup {
        width: 80%;
        font-size: 14px;
        padding: 15px;
      }
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-thumb {
      background-color: #00FFFF;
      border-radius: 3px;
    }
  </style>
</head>

<body>
  <div id="loader"><h2 style="color:#00FFFF;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</h2></div>

  <div class="container">
    <div class="app-title">‡¶¶‡¶æ‡¶ì‡ßü‡¶æ‡¶π ‡¶´‡ßã‡¶∞‡¶æ‡¶Æ</div>
    <div class="app-subtitle">‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡ßÄ ‡¶¨‡¶ø‡¶∑‡ßü‡ßá ‡¶Ü‡¶≤‡ßã‡¶ö‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</div>

    <!-- ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶´‡¶∞‡ßç‡¶Æ -->
    <div class="comment-form">
      <input type="text" id="userName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" maxlength="50">
      <textarea id="commentText" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß®‡ß¶‡ß¶ ‡¶∂‡¶¨‡ßç‡¶¶)..." maxlength="2000"></textarea>
      <button onclick="submitComment()">‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
      
      <!-- ‡¶Ö‡¶•‡ßá‡¶®‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¨‡ßã‡¶ü‡¶æ‡¶Æ -->
      <div class="auth-buttons">
        <button id="loginButton" onclick="showLoginPopup()">‡¶≤‡¶ó‡¶á‡¶®</button>
        <button id="logoutButton" onclick="adminLogout()" style="display: none;">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
      </div>
    </div>

    <!-- ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü -->
    <div class="comment-list" id="commentList"></div>
    <button class="load-more" id="loadMore" style="display: none;" onclick="loadMoreComments()">‡¶Ü‡¶∞‡ßã ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>

    <!-- ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡¶™‡¶Ü‡¶™ -->
    <div class="popup-overlay" id="loginOverlay" onclick="hideLoginPopup()"></div>
    <div class="login-popup" id="loginPopup">
      <h3>‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h3>
      <input type="password" id="adminPassword" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
      <br>
      <button onclick="adminLogin()">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      <button onclick="hideLoginPopup()">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
    </div>

    <!-- ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶™‡¶™‡¶Ü‡¶™ -->
    <div id="popup" class="popup">
      <div class="popup-content" id="popupMessage"></div>
      <button class="popup-close" onclick="closePopup()">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü
    window.addEventListener('load', function() {
      document.getElementById('loader').style.display = 'none';
      checkAdminStatus();
      loadComments();
    });

    // Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®
    const firebaseConfig = {
      apiKey: "AIzaSyAx_Yl-Qdd5RABXAxBwwByNW0dnrcBkpV0",
      authDomain: "dawah-352eb.firebaseapp.com",
      databaseURL: "https://dawah-352eb-default-rtdb.firebaseio.com",
      projectId: "dawah-352eb",
      storageBucket: "dawah-352eb.appspot.com",
      messagingSenderId: "129702043179",
      appId: "1:129702043179:web:6318cd5c1b3c200810946e",
      measurementId: "G-Z0E49NGVDG"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const commentsRef = db.ref('comments');

    // ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°
    const ADMIN_PASSWORD = "Fahim323015"; // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°

    // ‡¶™‡ßá‡¶ú‡¶ø‡¶®‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤
    let lastCommentKey = null;

    // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü
    function getUserId() {
      let userId = localStorage.getItem('dawahUserId');
      if (!userId) {
        userId = "user_" + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('dawahUserId', userId);
      }
      return userId;
    }

    // ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶è‡¶¨‡¶Ç ‡¶¨‡ßã‡¶ü‡¶æ‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
    function checkAdminStatus() {
      const isAdmin = localStorage.getItem('isAdmin') === 'true';
      const loginButton = document.getElementById('loginButton');
      const logoutButton = document.getElementById('logoutButton');

      if (isAdmin) {
        loginButton.style.display = 'none';
        logoutButton.style.display = 'inline-block';
      } else {
        loginButton.style.display = 'inline-block';
        logoutButton.style.display = 'none';
      }
    }

    // ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡¶™‡¶Ü‡¶™ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
    function showLoginPopup() {
      document.getElementById('loginPopup').style.display = 'block';
      document.getElementById('loginOverlay').style.display = 'block';
      document.getElementById('adminPassword').value = '';
      document.getElementById('adminPassword').focus();
    }

    // ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡¶™‡¶Ü‡¶™ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã
    function hideLoginPopup() {
      document.getElementById('loginPopup').style.display = 'none';
      document.getElementById('loginOverlay').style.display = 'none';
    }

    // ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function adminLogin() {
      const passwordInput = document.getElementById('adminPassword');
      const password = passwordInput.value;
      
      if (password === ADMIN_PASSWORD) {
        localStorage.setItem('isAdmin', 'true');
        localStorage.setItem('dawahUserId', 'admin_' + Math.random().toString(36).substr(2, 9));
        showPopup('‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!');
        hideLoginPopup();
        checkAdminStatus();
        loadComments(); // ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶¨‡ßã‡¶ü‡¶æ‡¶Æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
      } else {
        showPopup('‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        passwordInput.value = '';
        passwordInput.focus();
      }
    }

    // ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function adminLogout() {
      localStorage.removeItem('isAdmin');
      localStorage.removeItem('dawahUserId');
      showPopup('‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶∏‡¶´‡¶≤!');
      checkAdminStatus();
      loadComments(); // ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶¨‡ßã‡¶ü‡¶æ‡¶Æ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
    }

    // ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶ó‡¶£‡¶®‡¶æ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function countWords(text) {
      return text.trim().split(/\s+/).filter(word => word.length > 0).length;
    }

    // ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
    function submitComment() {
      const nameInput = document.getElementById('userName');
      const commentInput = document.getElementById('commentText');
      const name = nameInput.value.trim() || '‡¶Ö‡¶ú‡ßç‡¶û‡¶æ‡¶§';
      const comment = commentInput.value.trim();
      const isAdmin = localStorage.getItem('isAdmin') === 'true';

      if (!comment) {
        showPopup('‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!');
        return;
      }

      if (countWords(comment) > 200) {
        showPopup('‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß®‡ß¶‡ß¶ ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!');
        return;
      }

      const timestamp = new Date().toISOString();
      const commentData = {
        name: name,
        comment: comment,
        timestamp: timestamp,
        likes: 0,
        dislikes: 0,
        isAdmin: isAdmin
      };

      commentsRef.push(commentData).then(() => {
        showPopup('‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        nameInput.value = '';
        commentInput.value = '';
        lastCommentKey = null; // ‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶π‡¶≤‡ßá ‡¶™‡ßá‡¶ú‡¶ø‡¶®‡ßá‡¶∂‡¶® ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
        loadComments();
      }).catch(error => {
        showPopup('‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ' + error.message);
      });
    }

    // ‡¶∞‡¶ø‡¶™‡ßç‡¶≤‡¶æ‡¶á ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
    function submitReply(commentId) {
      const replyInput = document.getElementById(`replyText-${commentId}`);
      const replyText = replyInput.value.trim();
      const userName = document.getElementById(`replyName-${commentId}`).value.trim() || '‡¶Ö‡¶ú‡ßç‡¶û‡¶æ‡¶§';
      const isAdmin = localStorage.getItem('isAdmin') === 'true';

      if (!replyText) {
        showPopup('‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!');
        return;
      }

      if (countWords(replyText) > 200) {
        showPopup('‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß®‡ß¶‡ß¶ ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!');
        return;
      }

      const timestamp = new Date().toISOString();
      const replyData = {
        name: userName,
        reply: replyText,
        timestamp: timestamp,
        isAdmin: isAdmin
      };

      commentsRef.child(`${commentId}/replies`).push(replyData).then(() => {
        showPopup('‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        replyInput.value = '';
        document.getElementById(`replyName-${commentId}`).value = '';
        toggleReplyForm(commentId);
      }).catch(error => {
        showPopup('‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ' + error.message);
      });
    }

    // ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ
    function deleteComment(commentId) {
      if (localStorage.getItem('isAdmin') !== 'true') {
        showPopup('‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®!');
        return;
      }
      if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
        commentsRef.child(commentId).remove().then(() => {
          showPopup('‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
          loadComments();
        }).catch(error => {
          showPopup('‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ' + error.message);
        });
      }
    }

    // ‡¶≤‡¶æ‡¶á‡¶ï/‡¶°‡¶ø‡¶∏‡¶≤‡¶æ‡¶á‡¶ï ‡¶ü‡¶ó‡¶≤
    function toggleLike(commentId, type) {
      const userId = getUserId();
      const likeRef = db.ref(`comments/${commentId}/userVotes/${userId}`);
      likeRef.transaction(current => {
        if (!current) {
          return { type: type, timestamp: Date.now() };
        } else if (current.type === type) {
          return null;
        } else {
          return { type: type, timestamp: Date.now() };
        }
      }).then(() => {
        loadComments(); // ‡¶≠‡ßã‡¶ü ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂
      });
    }

    // ‡¶∞‡¶ø‡¶™‡ßç‡¶≤‡¶æ‡¶á ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ü‡¶ó‡¶≤
    function toggleReplyForm(commentId) {
      const replyForm = document.getElementById(`replyForm-${commentId}`);
      replyForm.style.display = replyForm.style.display === 'none' ? 'flex' : 'none';
    }

    // ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ (‡ßß‡ß¶‡¶ü‡¶ø ‡¶ï‡¶∞‡ßá)
    function loadComments() {
      const commentList = document.getElementById('commentList');
      const loadMoreButton = document.getElementById('loadMore');
      const isAdmin = localStorage.getItem('isAdmin') === 'true';

      // ‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡ßß‡ß¶‡¶ü‡¶ø ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
      let query = commentsRef.orderByChild('timestamp').limitToLast(10);
      if (lastCommentKey) {
        query = commentsRef.orderByChild('timestamp').endAt(lastCommentKey).limitToLast(11);
      }

      query.once('value', snapshot => {
        const comments = snapshot.val();
        if (!comments) {
          commentList.innerHTML = '<p>‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶®‡ßá‡¶á‡•§ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶ï‡¶∞‡ßÅ‡¶®!</p>';
          loadMoreButton.style.display = 'none';
          return;
        }

        const commentArray = Object.entries(comments).reverse();
        
        // ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶∞‡¶ì ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶ü‡¶ø ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡¶® (‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü)
        if (lastCommentKey) {
          commentArray.shift();
        }

        commentList.innerHTML = '';

        commentArray.forEach(([key, data]) => {
          const commentDiv = document.createElement('div');
          commentDiv.className = `comment ${data.isAdmin ? 'admin-comment' : ''}`;
          const date = new Date(data.timestamp);
          const userId = getUserId();
          const hasLiked = data.userVotes && data.userVotes[userId] && data.userVotes[userId].type === 'like';
          const hasDisliked = data.userVotes && data.userVotes[userId] && data.userVotes[userId].type === 'dislike';
          
          commentDiv.innerHTML = `
            <div class="comment-header">
              <span>${data.name}${data.isAdmin ? ' <span class="admin-badge">‡¶è‡¶°‡¶Æ‡¶ø‡¶®</span>' : ''}</span>
              <span>${date.toLocaleString('bn-BD')}</span>
            </div>
            <div class="comment-body">${data.comment}</div>
            <div class="comment-actions">
              <button onclick="toggleLike('${key}', 'like')" style="background: ${hasLiked ? '#0AAFAF' : ''}">
                üëç ‡¶≤‡¶æ‡¶á‡¶ï (${data.likes || 0})
              </button>
              <button onclick="toggleLike('${key}', 'dislike')" style="background: ${hasDisliked ? '#0AAFAF' : ''}">
                üëé ‡¶°‡¶ø‡¶∏‡¶≤‡¶æ‡¶á‡¶ï (${data.dislikes || 0})
              </button>
              <button onclick="toggleReplyForm('${key}')">‡¶∞‡¶ø‡¶™‡ßç‡¶≤‡¶æ‡¶á</button>
              ${isAdmin ? `<button class="delete-button" onclick="deleteComment('${key}')">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>` : ''}
            </div>
            <div class="reply-form" id="replyForm-${key}" style="display: none;">
              <input type="text" id="replyName-${key}" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" maxlength="50">
              <textarea id="replyText-${key}" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß®‡ß¶‡ß¶ ‡¶∂‡¶¨‡ßç‡¶¶)..." maxlength="2000"></textarea>
              <button onclick="submitReply('${key}')">‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
            </div>
            <div class="replies">
              ${data.replies ? Object.entries(data.replies).map(([replyId, reply]) => `
                <div class="reply ${reply.isAdmin ? 'admin-reply' : ''}">
                  <div class="reply-header">
                    <span>${reply.name}${reply.isAdmin ? ' <span class="admin-badge">‡¶è‡¶°‡¶Æ‡¶ø‡¶®</span>' : ''}</span>
                    <span>${new Date(reply.timestamp).toLocaleString('bn-BD')}</span>
                  </div>
                  <div class="reply-body">${reply.reply}</div>
                </div>
              `).join('') : ''}
            </div>
          `;
          commentList.appendChild(commentDiv);
        });

        // ‡¶Ü‡¶∞‡ßã ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
        if (commentArray.length > 0) {
          lastCommentKey = commentArray[commentArray.length - 1][1].timestamp;
        }

        // ‡¶Ü‡¶∞‡ßã ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶¨‡ßã‡¶ü‡¶æ‡¶Æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
        commentsRef.orderByChild('timestamp').endBefore(lastCommentKey).limitToLast(1).once('value', snapshot => {
          loadMoreButton.style.display = snapshot.val() && Object.keys(snapshot.val() || {}).length > 0 ? 'block' : 'none';
        });
      });
    }

    // ‡¶Ü‡¶∞‡ßã ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
    function loadMoreComments() {
      loadComments();
    }

    // ‡¶™‡¶™‡¶Ü‡¶™ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
    function showPopup(message) {
      const popup = document.getElementById('popup');
      const popupMessage = document.getElementById('popupMessage');
      popupMessage.textContent = message;
      popup.style.display = 'block';
      setTimeout(() => {
        popup.style.display = 'none';
      }, 3000);
    }

    // ‡¶™‡¶™‡¶Ü‡¶™ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
    function closePopup() {
      document.getElementById('popup').style.display = 'none';
    }
  </script>
</body>
</html>
