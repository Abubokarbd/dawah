<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>দাওয়াহ - কমেন্ট ফোরাম</title>

  <!-- SEO & Social Meta -->
  <meta name="description" content="দাওয়াহ অ্যাপ: ইসলামী বিষয়ে কমেন্ট ফোরাম">
  <meta name="keywords" content="দাওয়াহ, ইসলাম, কমেন্ট, ফোরাম, বাংলা">
  <meta name="author" content="Abubokar">
  <meta property="og:title" content="দাওয়াহ কমেন্ট ফোরাম">
  <meta property="og:description" content="ইসলামী বিষয়ে আলোচনার জন্য দাওয়াহ ফোরামে যোগ দিন">
  <meta property="og:image" content="https://abubokarbd.github.io/dawah/logo.png">
  <meta property="og:url" content="https://abubokarbd.github.io/dawah/comment-forum.html">

  <!-- App Icon & Favicon -->
  <link rel="icon" href="https://abubokarbd.github.io/dawah/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="https://abubokarbd.github.io/dawah/app-icon.png">

  <!-- Hind Siliguri ফন্ট -->
  <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Hind Siliguri', sans-serif;
      background-color: #033E3E;
      color: #FFFFFF;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    #loader {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #033E3E;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .container {
      max-width: 960px;
      margin: auto;
      padding: 20px;
    }

    .app-title {
      font-size: 48px;
      margin-top: 10px;
      color: #00FFFF;
      font-weight: bold;
    }

    .app-subtitle {
      font-size: 20px;
      color: #AADDEE;
      margin-top: -10px;
      margin-bottom: 20px;
    }

    .admin-login {
      margin: 20px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      display: none; /* ডিফল্টভাবে লুকানো */
    }

    .admin-login input {
      width: 100%;
      max-width: 300px;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: #022B2B;
      color: #FFFFFF;
      font-family: 'Hind Siliguri', sans-serif;
      font-size: 16px;
    }

    .admin-login button {
      background: linear-gradient(145deg, #046868, #022B2B);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }

    .admin-login button:hover {
      background: linear-gradient(145deg, #0AAFAF, #055050);
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(0,0,0,0.4);
    }

    .admin-login button:active {
      transform: scale(0.97);
    }

    .comment-form {
      margin: 20px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    .comment-form input, .comment-form textarea {
      width: 100%;
      max-width: 500px;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: #022B2B;
      color: #FFFFFF;
      font-family: 'Hind Siliguri', sans-serif;
      font-size: 16px;
    }

    .comment-form textarea {
      min-height: 100px;
      resize: vertical;
    }

    .comment-form button {
      background: linear-gradient(145deg, #046868, #022B2B);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }

    .comment-form button:hover {
      background: linear-gradient(145deg, #0AAFAF, #055050);
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(0,0,0,0.4);
    }

    .comment-form button:active {
      transform: scale(0.97);
    }

    .comment-list {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .comment {
      background: linear-gradient(145deg, #046868, #022B2B);
      padding: 15px;
      border-radius: 10px;
      text-align: left;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    .admin-comment {
      border: 2px solid #FFD700; /* সোনালী বর্ডার এডমিনের জন্য */
      background: linear-gradient(145deg, #055050, #013636);
    }

    .comment-header {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #AADDEE;
      margin-bottom: 10px;
    }

    .admin-badge {
      background: #FFD700;
      color: #033E3E;
      padding: 2px 8px;
      border-radius: 5px;
      font-size: 12px;
      margin-left: 5px;
    }

    .comment-body {
      font-size: 16px;
      color: #FFFFFF;
    }

    .comment-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .comment-actions button {
      background: linear-gradient(145deg, #046868, #022B2B);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .comment-actions button:hover {
      background: linear-gradient(145deg, #0AAFAF, #055050);
      transform: translateY(-2px);
    }

    .comment-actions button:active {
      transform: scale(0.97);
    }

    .delete-button {
      background: linear-gradient(145deg, #A10000, #700000);
      color: white;
    }

    .delete-button:hover {
      background: linear-gradient(145deg, #C10000, #900000);
      transform: translateY(-2px);
    }

    .reply-form {
      margin-top: 10px;
      display: none;
      flex-direction: column;
      gap: 10px;
    }

    .reply-form textarea {
      min-height: 60px;
    }

    .replies {
      margin-top: 10px;
      padding-left: 20px;
      border-left: 2px solid #00FFFF;
    }

    .reply {
      background: linear-gradient(145deg, #055050, #022B2B);
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
    }

    .admin-reply {
      border: 2px solid #FFD700; /* সোনালী বর্ডার এডমিন রিপ্লাইয়ের জন্য */
      background: linear-gradient(145deg, #044444, #013636);
    }

    .reply-header {
      font-size: 13px;
      color: #AADDEE;
      margin-bottom: 5px;
    }

    .reply-body {
      font-size: 14px;
      color: #FFFFFF;
    }

    .popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(145deg, #046868, #022B2B);
      color: #FFFFFF;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.4);
      z-index: 1000;
      max-width: 90%;
      width: 300px;
      text-align: center;
      font-family: 'Hind Siliguri', sans-serif;
      font-size: 16px;
    }

    .popup-content {
      margin-bottom: 15px;
    }

    .popup-close {
      background: #00FFFF;
      color: #033E3E;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.3s ease;
    }

    .popup-close:hover {
      background: #0AAFAF;
    }

    @media (max-width: 600px) {
      .app-title {
        font-size: 36px;
      }

      .app-subtitle {
        font-size: 18px;
      }

      .comment-form input, .comment-form textarea {
        font-size: 14px;
      }

      .comment-form button {
        font-size: 14px;
        padding: 8px 16px;
      }

      .admin-login input {
        font-size: 14px;
      }

      .admin-login button {
        font-size: 14px;
        padding: 8px 16px;
      }

      .comment {
        padding: 10px;
      }

      .comment-body {
        font-size: 14px;
      }

      .comment-actions button {
        font-size: 12px;
        padding: 6px 10px;
      }

      .popup {
        width: 80%;
        font-size: 14px;
        padding: 15px;
      }
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-thumb {
      background-color: #00FFFF;
      border-radius: 3px;
    }
  </style>
</head>

<body>
  <div id="loader"><h2 style="color:#00FFFF;">লোড হচ্ছে...</h2></div>

  <div class="container">
    <div class="app-title">দাওয়াহ ফোরাম</div>
    <div class="app-subtitle">ইসলামী বিষয়ে আলোচনা করুন</div>

    <!-- এডমিন লগইন ফর্ম -->
    <div class="admin-login" id="adminLoginForm">
      <input type="password" id="adminPassword" placeholder="এডমিন পাসওয়ার্ড লিখুন">
      <button onclick="adminLogin()">লগইন করুন</button>
    </div>

    <!-- কমেন্ট ফর্ম -->
    <div class="comment-form">
      <input type="text" id="userName" placeholder="আপনার নাম (ঐচ্ছিক)" maxlength="50">
      <textarea id="commentText" placeholder="আপনার মন্তব্য লিখুন..." maxlength="500"></textarea>
      <button onclick="submitComment()">মন্তব্য জমা দিন</button>
      <button onclick="toggleAdminLogin()">এডমিন লগইন</button>
      <button onclick="adminLogout()" id="adminLogout" style="display: none;">লগআউট</button>
    </div>

    <!-- কমেন্ট লিস্ট -->
    <div class="comment-list" id="commentList"></div>

    <!-- পপআপ -->
    <div id="popup" class="popup">
      <div class="popup-content" id="popupMessage"></div>
      <button class="popup-close" onclick="closePopup()">বন্ধ করুন</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // লোডার স্ক্রিপ্ট
    window.addEventListener('load', function() {
      document.getElementById('loader').style.display = 'none';
      checkAdminStatus();
    });

    // Firebase কনফিগারেশন
    const firebaseConfig = {
      apiKey: "AIzaSyAx_Yl-Qdd5RABXAxBwwByNW0dnrcBkpV0",
      authDomain: "dawah-352eb.firebaseapp.com",
      databaseURL: "https://dawah-352eb-default-rtdb.firebaseio.com",
      projectId: "dawah-352eb",
      storageBucket: "dawah-352eb.appspot.com",
      messagingSenderId: "129702043179",
      appId: "1:129702043179:web:6318cd5c1b3c200810946e",
      measurementId: "G-Z0E49NGVDG"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const commentsRef = db.ref('comments');

    // এডমিন পাসওয়ার্ড
    const ADMIN_PASSWORD = "Fahim323015"; // আপনার নির্বাচিত পাসওয়ার্ড

    // ইউজার আইডি জেনারেট
    function getUserId() {
      let userId = localStorage.getItem('dawahUserId');
      if (!userId) {
        userId = "user_" + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('dawahUserId', userId);
      }
      return userId;
    }

    // এডমিন স্ট্যাটাস চেক
    function checkAdminStatus() {
      const isAdmin = localStorage.getItem('isAdmin') === 'true';
      const adminLoginForm = document.getElementById('adminLoginForm');
      const adminLogoutButton = document.getElementById('adminLogout');
      if (isAdmin) {
        adminLoginForm.style.display = 'none';
        adminLogoutButton.style.display = 'block';
      } else {
        adminLoginForm.style.display = 'flex';
        adminLogoutButton.style.display = 'none';
      }
    }

    // এডমিন লগইন ফাংশন
    function adminLogin() {
      const passwordInput = document.getElementById('adminPassword');
      const password = passwordInput.value;
      if (password === ADMIN_PASSWORD) {
        localStorage.setItem('isAdmin', 'true');
        localStorage.setItem('dawahUserId', 'admin_' + Math.random().toString(36).substr(2, 9));
        showPopup('এডমিন লগইন সফল!');
        checkAdminStatus();
        passwordInput.value = '';
      } else {
        showPopup('ভুল পাসওয়ার্ড! আবার চেষ্টা করুন।');
      }
    }

    // এডমিন লগআউট ফাংশন
    function adminLogout() {
      localStorage.removeItem('isAdmin');
      localStorage.removeItem('dawahUserId');
      showPopup('এডমিন লগআউট সফল!');
      checkAdminStatus();
    }

    // এডমিন লগইন ফর্ম টগল
    function toggleAdminLogin() {
      const adminLoginForm = document.getElementById('adminLoginForm');
      adminLoginForm.style.display = adminLoginForm.style.display === 'none' ? 'flex' : 'none';
    }

    // কমেন্ট জমা দেওয়া
    function submitComment() {
      const nameInput = document.getElementById('userName');
      const commentInput = document.getElementById('commentText');
      const name = nameInput.value.trim() || 'অজ্ঞাত';
      const comment = commentInput.value.trim();
      const isAdmin = localStorage.getItem('isAdmin') === 'true';

      if (!comment) {
        showPopup('দয়া করে একটি মন্তব্য লিখুন!');
        return;
      }

      const timestamp = new Date().toISOString();
      const commentData = {
        name: name,
        comment: comment,
        timestamp: timestamp,
        likes: 0,
        dislikes: 0,
        isAdmin: isAdmin
      };

      commentsRef.push(commentData).then(() => {
        showPopup('মন্তব্য সফলভাবে জমা দেওয়া হয়েছে!');
        nameInput.value = '';
        commentInput.value = '';
      }).catch(error => {
        showPopup('মন্তব্য জমা দিতে সমস্যা: ' + error.message);
      });
    }

    // রিপ্লাই জমা দেওয়া
    function submitReply(commentId) {
      const replyInput = document.getElementById(`replyText-${commentId}`);
      const replyText = replyInput.value.trim();
      const userName = document.getElementById(`replyName-${commentId}`).value.trim() || 'অজ্ঞাত';
      const isAdmin = localStorage.getItem('isAdmin') === 'true';

      if (!replyText) {
        showPopup('দয়া করে একটি উত্তর লিখুন!');
        return;
      }

      const timestamp = new Date().toISOString();
      const replyData = {
        name: userName,
        reply: replyText,
        timestamp: timestamp,
        isAdmin: isAdmin
      };

      commentsRef.child(`${commentId}/replies`).push(replyData).then(() => {
        showPopup('উত্তর সফলভাবে জমা দেওয়া হয়েছে!');
        replyInput.value = '';
        document.getElementById(`replyName-${commentId}`).value = '';
        toggleReplyForm(commentId);
      }).catch(error => {
        showPopup('উত্তর জমা দিতে সমস্যা: ' + error.message);
      });
    }

    // মন্তব্য ডিলিট করা
    function deleteComment(commentId) {
      if (localStorage.getItem('isAdmin') !== 'true') {
        showPopup('শুধুমাত্র এডমিন মন্তব্য মুছতে পারেন!');
        return;
      }
      if (confirm('আপনি কি এই মন্তব্যটি মুছতে চান?')) {
        commentsRef.child(commentId).remove().then(() => {
          showPopup('মন্তব্য সফলভাবে মুছে ফেলা হয়েছে!');
        }).catch(error => {
          showPopup('মন্তব্য মুছতে সমস্যা: ' + error.message);
        });
      }
    }

    // লাইক/ডিসলাইক টগল
    function toggleLike(commentId, type) {
      const userId = getUserId();
      const likeRef = db.ref(`comments/${commentId}/userVotes/${userId}`);
      likeRef.transaction(current => {
        if (!current) {
          return { type: type, timestamp: Date.now() };
        } else if (current.type === type) {
          return null; // Remove vote
        } else {
          return { type: type, timestamp: Date.now() }; // Switch vote
        }
      }).then(result => {
        if (result.snapshot.exists()) {
          const newType = result.snapshot.val().type;
          const countRef = db.ref(`comments/${commentId}/${newType === 'like' ? 'likes' : 'dislikes'}`);
          countRef.transaction(count => (count || 0) + 1);
          if (current && current.type !== newType) {
            const oldCountRef = db.ref(`comments/${commentId}/${current.type === 'like' ? 'likes' : 'dislikes'}`);
            oldCountRef.transaction(count => Math.max(0, (count || 0) - 1));
          }
        } else {
          const oldCountRef = db.ref(`comments/${commentId}/${type === 'like' ? 'likes' : 'dislikes'}`);
          oldCountRef.transaction(count => Math.max(0, (count || 0) - 1));
        }
      });
    }

    // রিপ্লাই ফর্ম টগল
    function toggleReplyForm(commentId) {
      const replyForm = document.getElementById(`replyForm-${commentId}`);
      replyForm.style.display = replyForm.style.display === 'none' ? 'flex' : 'none';
    }

    // কমেন্ট লোড করা
    commentsRef.on('value', snapshot => {
      const commentList = document.getElementById('commentList');
      commentList.innerHTML = '';
      const comments = snapshot.val();
      const isAdmin = localStorage.getItem('isAdmin') === 'true';
      if (comments) {
        Object.entries(comments).reverse().forEach(([key, data]) => {
          const commentDiv = document.createElement('div');
          commentDiv.className = `comment ${data.isAdmin ? 'admin-comment' : ''}`;
          const date = new Date(data.timestamp);
          const userId = getUserId();
          const hasLiked = data.userVotes && data.userVotes[userId] && data.userVotes[userId].type === 'like';
          const hasDisliked = data.userVotes && data.userVotes[userId] && data.userVotes[userId].type === 'dislike';
          commentDiv.innerHTML = `
            <div class="comment-header">
              <span>${data.name}${data.isAdmin ? ' <span class="admin-badge">এডমিন</span>' : ''}</span>
              <span>${date.toLocaleString('bn-BD')}</span>
            </div>
            <div class="comment-body">${data.comment}</div>
            <div class="comment-actions">
              <button onclick="toggleLike('${key}', 'like')" style="background: ${hasLiked ? '#0AAFAF' : ''}">
                👍 লাইক (${data.likes || 0})
              </button>
              <button onclick="toggleLike('${key}', 'dislike')" style="background: ${hasDisliked ? '#0AAFAF' : ''}">
                👎 ডিসলাইক (${data.dislikes || 0})
              </button>
              <button onclick="toggleReplyForm('${key}')">রিপ্লাই</button>
              ${isAdmin ? `<button class="delete-button" onclick="deleteComment('${key}')">ডিলিট</button>` : ''}
            </div>
            <div class="reply-form" id="replyForm-${key}">
              <input type="text" id="replyName-${key}" placeholder="আপনার নাম (ঐচ্ছিক)" maxlength="50">
              <textarea id="replyText-${key}" placeholder="আপনার উত্তর লিখুন..." maxlength="500"></textarea>
              <button onclick="submitReply('${key}')">উত্তর জমা দিন</button>
            </div>
            <div class="replies">
              ${data.replies ? Object.entries(data.replies).map(([replyId, reply]) => `
                <div class="reply ${reply.isAdmin ? 'admin-reply' : ''}">
                  <div class="reply-header">
                    <span>${reply.name}${reply.isAdmin ? ' <span class="admin-badge">এডমিন</span>' : ''}</span>
                    <span>${new Date(reply.timestamp).toLocaleString('bn-BD')}</span>
                  </div>
                  <div class="reply-body">${reply.reply}</div>
                </div>
              `).join('') : ''}
            </div>
          `;
          commentList.appendChild(commentDiv);
        });
      } else {
        commentList.innerHTML = '<p>কোনো মন্তব্য নেই। প্রথম মন্তব্য করুন!</p>';
      }
    });

    // পপআপ দেখানো
    function showPopup(message) {
      const popup = document.getElementById('popup');
      const popupMessage = document.getElementById('popupMessage');
      popupMessage.textContent = message;
      popup.style.display = 'block';
      setTimeout(() => {
        popup.style.display = 'none';
      }, 3000);
    }

    // পপআপ বন্ধ করা
    function closePopup() {
      document.getElementById('popup').style.display = 'none';
    }
  </script>
</body>
</html>
